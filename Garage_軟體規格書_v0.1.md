# Garage App - 軟體規格書

> 版本：v0.1 Draft  
> 最後更新：2025/11/25  
> 狀態：MVP 規劃中

---

## 1. 產品概述

### 1.1 產品定位

愛車管家是一款專為汽車愛好者設計的車輛管理 App，主打 **保養/改裝紀錄** 與 **測速照相提醒** 兩大核心功能，採用簡潔的 Apple 風格設計，讓車主輕鬆管理愛車的所有花費與行車安全。

### 1.2 目標用戶

- 重視愛車保養的車主
- 汽車改裝愛好者
- 需要測速提醒的通勤族

### 1.3 核心價值

| 價值 | 說明 |
|------|------|
| 紀錄管理 | 一站式管理保養、改裝、加油等所有車輛花費 |
| 行車安全 | 測速照相提醒，避免超速罰單 |
| 簡潔易用 | Apple 風格 UI，操作直覺無負擔 |

---

## 2. 技術規格

### 2.1 開發框架

| 項目 | 選擇 |
|------|------|
| 框架 | Flutter |
| 平台 | iOS / Android |
| 資料儲存 | Local Storage（Hive 或 SQLite） |
| 狀態管理 | TODO: 待決定（BLoC / Riverpod / Provider） |

### 2.2 Phase 規劃

| Phase | 功能範圍 |
|-------|----------|
| **PH1** | 測速提醒（固定點 + 區間測速）、背景執行、紀錄 CRUD、本地儲存 |
| **PH2** | 導航整合、雲端同步、訂閱制功能 |

---

## 3. 資訊架構

### 3.1 App 結構

```
App
├── Bottom Navigation Bar
│   ├── Tab 1: 測速
│   ├── Tab 2: 紀錄
│   └── Tab 3: 設定
│
├── 測速頁面
│   ├── 3D 道路場景
│   ├── HUD 速度顯示
│   ├── 測速照相提醒卡片
│   └── 偵測開關
│
├── 紀錄頁面
│   ├── 愛車資訊 Header
│   ├── 統計卡片（本月/本年/自訂）
│   ├── 類別堆疊卡片（Overlap Cards）
│   ├── 最近紀錄列表
│   └── FAB 新增按鈕
│
├── 類別清單頁（轉場進入）
│   ├── 圓餅圖統計
│   └── 紀錄列表
│
└── 設定頁面
    └── TODO: 待規劃
```

---

## 4. 測速頁面規格

### 4.1 畫面結構

```
┌─────────────────────────────────────┐
│                                     │
│      🛣️ 3D 道路場景                  │
│      （簡化版：直線道路 + 車輛）      │
│                                     │
│           ┌───────────┐             │
│           │    72     │             │
│           │   km/h    │             │
│           └───────────┘             │
│                                     │
│         ┌─────────────────┐         │
│         │ ⚠️ 500m 限速 50  │         │
│         └─────────────────┘         │
│                                     │
│      ┌────────────────────────┐     │
│      │   ● 測速偵測中          │     │
│      │   [====開關====]       │     │
│      └────────────────────────┘     │
│                                     │
├─────────────────────────────────────┤
│   測速    │   紀錄    │    設定     │
└─────────────────────────────────────┘
```

### 4.2 功能規格

#### 4.2.1 測速偵測開關

| 項目 | 規格 |
|------|------|
| 元件 | Switch 或大按鈕 |
| 狀態文字 | 開啟：「測速偵測中 ●」／關閉：「測速偵測已關閉」 |
| 預設 | 關閉（省電考量） |
| 開啟行為 | 啟動 GPS 監聽、載入附近測速點 |

#### 4.2.2 速度顯示（HUD 風格）

| 項目 | 規格 |
|------|------|
| 資料來源 | GPS speed（geolocator） |
| 更新頻率 | 依車速動態調整（見 4.2.6） |
| 顯示格式 | 整數，單位 km/h |
| 偵測關閉時 | 顯示 `--` km/h |
| 顏色邏輯 | 正常：白/綠、接近超速：橘、超速：紅 |

#### 4.2.3 3D 道路場景（PH1 簡化版）

| 項目 | 規格 |
|------|------|
| 道路 | 直線道路，無彎曲 |
| 車輛 | 固定位置，不動 |
| 動態感 | 道路紋理向下滾動（依車速調整速度） |
| 偵測關閉時 | 場景靜止、灰階或暗化處理 |

#### 4.2.4 測速照相提醒

| 項目 | 規格 |
|------|------|
| 提醒距離 | 預設 1km（設定頁可調整） |
| 顯示內容 | 距離（公尺）+ 限速 |
| 多點處理 | 只顯示最近一點 |
| 提醒方式 | 視覺 + 聲音 + 震動（可個別開關） |
| 重複提醒 | 同一點只提醒一次（通過後重置） |

#### 4.2.5 區間測速

| 階段 | 觸發條件 | 系統行為 |
|------|----------|----------|
| 進入區間 | 通過起點 | 記錄時間、開始計算 |
| 區間內 | 在起點與終點之間 | 顯示「區間測速中」+ 目前均速 + 剩餘距離 |
| 離開區間 | 通過終點 | 計算平均速度、判斷是否超速 |

**區間測速 UI**

```
┌─────────────────────────┐
│ 📍 區間測速中            │
│ 限速 50 km/h            │
│ 目前均速：48 km/h ✅     │
│ 剩餘距離：1.2 km        │
└─────────────────────────┘
```

#### 4.2.6 省電機制

| 車速 | GPS 更新頻率 |
|------|-------------|
| < 10 km/h（靜止/塞車） | 5 秒 |
| 10-60 km/h（市區） | 2 秒 |
| > 60 km/h（快速道路） | 1 秒 |

#### 4.2.7 背景執行

| 項目 | 規格 |
|------|------|
| 觸發條件 | 開關開啟時，切到背景繼續執行 |
| 通知 | 前景服務通知「愛車管家正在偵測測速照相」 |
| 提醒方式 | 推播通知 + 聲音 + 震動 |
| 關閉條件 | 手動關閉開關 或 App 被強制終止 |

**技術方案**

- Android：Foreground Service
- iOS：Background Location Updates
- Flutter 套件：`flutter_background_service` + `geolocator`

### 4.3 測速資料

#### 4.3.1 資料來源

台灣政府開放資料（定期更新）

#### 4.3.2 資料結構

```
SpeedCamera
├── id: String
├── latitude: Double
├── longitude: Double
├── speedLimit: Int (km/h)
├── type: String (fixed / average)
├── direction: String? (選填)
│
│  // 區間測速額外欄位
├── isAverageSpeedStart: Boolean
├── averageSpeedEndId: String? (對應終點 ID)
└── averageSpeedDistance: Double? (區間距離)
```

### 4.4 狀態流程

```
┌──────────────┐
│   偵測關閉   │ ← 預設狀態
└──────┬───────┘
       │ 開啟開關
       ▼
┌──────────────┐
│   偵測中     │ ← GPS 啟動、監聽位置
└──────┬───────┘
       │ 接近測速點（< 1km）
       ▼
┌──────────────┐
│   提醒中     │ ← 顯示提醒卡片、播放聲音
└──────┬───────┘
       │ 通過測速點
       ▼
┌──────────────┐
│   偵測中     │ ← 回到正常監聽
└──────────────┘
```

### 4.5 PH2 功能（導航整合）

> TODO: Phase 2 再詳細規劃

- 整合導航功能
- 左右轉提示
- 路線規劃

---

## 5. 紀錄頁面規格

### 5.1 畫面結構

```
┌─────────────────────────────────────┐
│  紀錄                               │
├─────────────────────────────────────┤
│                                     │
│  🚗 FK8 Type R · 45,230 km          │
│                                     │
│  ┌─────────────┐ ┌─────────────┐   │
│  │ 本月        │ │ 本年        │   │
│  │ $12,500    │ │ $156,200   │   │
│  └─────────────┘ └─────────────┘   │
│         [ 自訂區間 ▼ ]              │
│                                     │
├─────────────────────────────────────┤
│                                     │
│    ┌──────┐                        │
│   ┌──────┐│  ┌──────┐  ┌──────┐   │
│  ┌──────┐││ ┌──────┐│ ┌──────┐│   │
│  │🔧    │┘│ │⚙️    │┘ │⛽    ││→  │
│  │保養  │──┘│改裝  │  │加油  │┘   │
│  │$45k │   │$120k│  │$8k  │    │
│  │  12 │   │  8  │  │ 24  │    │
│  └──────┘   └──────┘  └──────┘     │
│                                     │
│         ← 左右滑動更多 →             │
│                                     │
├─────────────────────────────────────┤
│  最近紀錄                           │
│                                     │
│  🟢 機油更換      $3,500   11/20   │
│  🟡 中油 95       $1,200   11/24   │
│  🔵 排氣管        $45,000  11/15   │
│                                     │
│              ＋                     │
├─────────────────────────────────────┤
│   測速    │   紀錄    │    設定     │
└─────────────────────────────────────┘
```

### 5.2 類別堆疊卡片

#### 5.2.1 顯示規則

| 項目 | 規格 |
|------|------|
| 一次顯示 | 3 組 |
| 滑動 | 左右滑動顯示更多 |
| 堆疊層數 | 最多 3 層 |
| 卡片資訊 | Icon + 名稱 + 總金額 + 筆數 |

#### 5.2.2 堆疊邏輯

| 情境 | 顯示方式 |
|------|----------|
| 單筆紀錄 | 單張卡片 |
| 2-3 筆 | 2-3 層堆疊，微微錯開 |
| 4 筆以上 | 最多顯示 3 層 + 角標數字 |

#### 5.2.3 類別順序（預設）

保養 → 改裝 → 加油 → 保險 → 稅費 → 其他

### 5.3 分類系統

#### 5.3.1 類別色彩

| 類別 | 顏色 | Icon |
|------|------|------|
| 保養 | 🟢 綠色 | 🔧 |
| 改裝 | 🔵 藍色 | ⚙️ |
| 加油 | 🟡 黃色 | ⛽ |
| 保險 | 🟣 紫色 | 📋 |
| 稅費 | 🟠 橘色 | 📄 |
| 其他 | ⚪ 灰色 | ➕ |

#### 5.3.2 主類別 + 預設子分類

| 主類別 | 預設子分類 |
|--------|-----------|
| 🔧 保養 | 機油、輪胎、煞車、冷卻液、變速箱油、火星塞、空濾、其他 |
| ⚙️ 改裝 | 進氣、排氣、懸吊、煞車、外觀、內裝、電子、其他 |
| ⛽ 加油 | 92、95、98、柴油、其他 |
| 📋 保險 | 強制險、第三人、車體險、其他 |
| 📄 稅費 | 牌照稅、燃料稅、其他 |
| ➕ 其他 | 維修、美容、停車、罰單、配件、自訂... |

#### 5.3.3 自訂功能（Phase 2）

- 用戶可新增子分類
- 用戶可隱藏不需要的子分類

### 5.4 轉場動畫

#### 5.4.1 點擊堆疊卡片 → 清單頁

| 階段 | 動畫 | 時長 |
|------|------|------|
| 點擊回饋 | 卡片縮放 0.95 → 1.0 | 100ms |
| 堆疊展開 | 卡片散開後合併 | 200ms |
| Hero 轉場 | 卡片飛到清單頁 header | 300ms |
| 內容淡入 | 圓餅圖 + 列表滑入 | 300ms |
| 返回動畫 | 以上反向播放 | 400ms |

**Flutter 實作參考**

- `Hero` animation（卡片飛到新頁面）
- `AnimatedContainer` + `Stack`（堆疊展開）

### 5.5 類別清單頁

#### 5.5.1 畫面結構

```
┌─────────────────────────────────────┐
│  ← 返回         保養         📊    │
├─────────────────────────────────────┤
│                                     │
│     ┌─────────────────────┐        │
│     │      圓餅圖          │        │
│     │   機油 40%          │        │
│     │   輪胎 25%          │        │
│     │   煞車 20%          │        │
│     │   其他 15%          │        │
│     │                     │        │
│     │    中心：$45,000    │        │
│     └─────────────────────┘        │
│                                     │
├─────────────────────────────────────┤
│  紀錄列表                           │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ 機油更換                      │  │
│  │ $3,500 · 11/20 · 45,012km    │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 輪胎更換                      │  │
│  │ $12,000 · 10/15 · 42,500km   │  │
│  └───────────────────────────────┘  │
│                                     │
│              ＋                     │
└─────────────────────────────────────┘
```

#### 5.5.2 圓餅圖規格

| 項目 | 規格 |
|------|------|
| 顯示內容 | 該類別下的子分類佔比 |
| 互動 | 點擊扇區 highlight + 顯示金額 |
| 中心 | 顯示總金額 |
| 配色 | 同類別主色的深淺變化 |

#### 5.5.3 列表規格

| 項目 | 規格 |
|------|------|
| 排序 | 日期倒序（最新在上） |
| 列表項目 | 子分類名稱 + 金額 + 日期 + 里程 |

### 5.6 統計功能

#### 5.6.1 區間選項

| 選項 | 說明 |
|------|------|
| 本月 | 當月 1 號至今 |
| 本年 | 當年 1/1 至今 |
| 全部 | 所有紀錄 |
| 自訂 | 選擇起迄日期 |

### 5.7 紀錄欄位定義

#### 5.7.1 通用欄位（所有類別）

| 欄位 | 必填 | 說明 |
|------|------|------|
| 主類別 | ✅ | 保養/改裝/加油... |
| 子分類 | ✅ | 機油/輪胎... |
| 金額 | ✅ | 數字輸入 |
| 日期 | ✅ | 預設今天 |
| 里程 | ⬜ | 選填，可自動帶入上次 |
| 備註 | ⬜ | 文字輸入 |
| 照片 | ⬜ | 可多張（改裝類別常用） |

#### 5.7.2 加油專屬欄位

| 欄位 | 必填 | 說明 |
|------|------|------|
| 公升數 | ⬜ | 計算油耗用 |
| 油價/L | ⬜ | 自動計算或手動輸入 |

---

## 6. 設定頁面規格

> TODO: 待規劃

### 6.1 預計項目

- [ ] 訂閱狀態/升級入口
- [ ] 主題切換（深色/淺色）
- [ ] 測速提醒設定（距離、音效、震動）
- [ ] 資料管理（匯出/清除）
- [ ] 關於/意見回饋
- [ ] 愛車資訊編輯

---

## 7. 新增紀錄流程

> TODO: 待規劃

### 7.1 預計內容

- [ ] FAB 點擊後的類別選擇互動
- [ ] 新增表單 UI
- [ ] 照片上傳流程
- [ ] 表單驗證規則

---

## 8. 資料結構

### 8.1 車輛資料

```
Vehicle
├── id: String
├── name: String (例：FK8 Type R)
├── brand: String
├── model: String
├── year: Int
├── currentMileage: Int
├── plateNumber: String?
└── photoPath: String?
```

### 8.2 紀錄資料

```
Record
├── id: String
├── vehicleId: String
├── category: String (主類別)
├── subCategory: String (子分類)
├── amount: Double
├── date: DateTime
├── mileage: Int?
├── note: String?
├── photoPaths: List<String>?
│
│  // 加油專屬
├── liters: Double?
└── pricePerLiter: Double?
```

### 8.3 測速點資料

```
SpeedCamera
├── id: String
├── latitude: Double
├── longitude: Double
├── speedLimit: Int
├── type: String (fixed / average)
├── direction: String?
├── isAverageSpeedStart: Boolean
├── averageSpeedEndId: String?
└── averageSpeedDistance: Double?
```

---

## 9. 商業模式

### 9.1 免費版

- 基本保養/改裝/加油紀錄
- 里程追蹤
- 測速照相提醒（基本版）
- Local Storage 儲存

### 9.2 付費/訂閱版（建議 NT$30-50/月）

- 保養到期智慧提醒
- 改裝前後照片對比（時間軸相簿）
- 花費統計圖表（月/年報表）
- 測速點即時更新 + 區間測速提醒
- 資料匯出（CSV/PDF）
- 無廣告

### 9.3 單次付費項目（替代方案）

- 愛車桌布生成包（5 張 NT$30）
- 完整版一次買斷 NT$150-200

---

## 10. TODO 清單

### 10.1 待討論

- [ ] 設定頁面完整規格
- [ ] 新增紀錄流程 UI/UX
- [ ] FAB 展開動畫（扇形/圓形/垂直列表）
- [ ] 愛車桌布生成功能規格
- [ ] 多車支援（PH2?）

### 10.2 待決定

- [ ] 狀態管理方案（BLoC / Riverpod / Provider）
- [ ] Local Storage 選擇（Hive vs SQLite + drift）
- [ ] 3D 場景技術方案（Canvas / Rive / Unity）
- [ ] 測速資料更新機制

### 10.3 待研究

- [ ] 台灣政府測速點開放資料格式與 API
- [ ] iOS 背景定位審核要求
- [ ] App Store / Google Play 上架需求

---

## 附錄

### A. 參考資料

- TODO: 競品分析
- TODO: UI 參考圖

### B. 版本紀錄

| 版本 | 日期 | 說明 |
|------|------|------|
| v0.1 | 2025/11/25 | 初版草稿，完成測速頁面、紀錄頁面規格 |
